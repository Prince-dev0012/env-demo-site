<!DOCTYPE html>
<html>
<head>

<title>ENV Final Test</title>

<meta name="viewport"
      content="width=device-width, initial-scale=1.0">

<!-- SHA256 -->
<script src="https://cdn.jsdelivr.net/npm/js-sha256@0.9.0/src/sha256.min.js"></script>

<style>
body{
  background:black;
  color:lime;
  font-family:Arial;
  padding:20px;
}
.box{
  border:2px solid lime;
  padding:20px;
  max-width:700px;
}
pre{
  white-space:pre-wrap;
  word-break:break-word;
}
</style>

</head>
<body>

<div class="box">

<h2>ENV Debug Test</h2>

<pre id="debug">Generating...</pre>

<hr>

<pre id="result">
Loading ENV...
</pre>

</div>

<script>

/* ================= CONFIG ================= */

const repo="testing-env";
const key ="fdf9119bf119a445";
const salt="my-super-salt-789";

/* ================= SIGNATURE ================= */

const sig=sha256(repo+key+salt);

/* ================= API URL ================= */

const apiURL=
"https://myenv.my-style.in/api.php"+
"?repo="+repo+
"&key="+key+
"&sig="+sig;

/* ================= DEBUG INFO ================= */

document.getElementById("debug").innerText=
"Repo: "+repo+"\n"+
"Key: "+key+"\n"+
"Salt: "+salt+"\n\n"+
"Generated Signature:\n"+sig+"\n\n"+
"API URL:\n"+apiURL;

/* ================= FETCH ================= */

fetch(apiURL,{
  method:"GET",
  mode:"cors"
})

.then(res=>{

  if(!res.ok){
    throw new Error(
      "HTTP "+res.status
    );
  }

  return res.text(); // safer than json()

})

.then(text=>{

  try{

    const env=JSON.parse(text);

    document.getElementById("result")
    .innerText=
    JSON.stringify(env,null,2);

  }
  catch{

    document.getElementById("result")
    .innerText=
    "Raw Response:\n"+text;

  }

})

.catch(err=>{

  document.getElementById("result")
  .innerText=
  "Fetch Failed:\n"+err+
  "\n\nLikely causes:\n"+
  "- CORS blocked\n"+
  "- InfinityFree firewall\n"+
  "- Mixed content\n"+
  "- Network issue";

});

</script>

</body>
</html>
